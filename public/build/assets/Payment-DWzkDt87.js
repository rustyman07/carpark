import{_ as ie,q as k,j as b,M as re,z as n,g as S,o as g,a as s,b as t,w as a,f as l,i as y,t as i,d as h,c as D,F as ue,u as ce,J as Y,A as me}from"./app-NUBUC0vD.js";import{H as ve}from"./html5-qrcode-scanner-BZty-w_P.js";import{d as B}from"./dayjs.min-Do_9EaZr.js";import{f}from"./utility-C4IXQQAA.js";const pe={class:"d-flex align-center"},fe={class:"payment-wrapper"},_e={class:"page-header mb-6 text-center"},be={class:"card-header pa-6 pb-4"},ge={class:"d-flex align-center justify-space-between"},ye={class:"text-h6 font-weight-bold text-indigo-darken-4"},he={class:"pa-6"},xe={class:"info-item mb-4"},ke={class:"d-flex align-center mb-2"},we={class:"text-h6 font-weight-bold text-indigo-darken-4 mb-0 ml-7"},Ce={class:"info-item mb-4"},Ne={class:"d-flex align-center mb-2"},Pe={class:"text-subtitle-1 font-weight-medium mb-0 ml-7"},Ve={class:"text-body-2 text-success font-weight-bold ml-7"},ze={class:"info-item mb-4"},je={class:"d-flex align-center mb-2"},Ae={class:"text-subtitle-1 font-weight-medium mb-0 ml-7"},Se={class:"text-body-2 text-error font-weight-bold ml-7"},De={key:0,class:"info-item mb-4"},Me={class:"d-flex align-center justify-space-between"},Qe={class:"d-flex align-center"},Re={class:"text-h6 font-weight-bold text-indigo-darken-4"},qe={key:1,class:"info-item mb-4"},Be={class:"d-flex align-center justify-space-between"},Te={class:"d-flex align-center"},Ue={class:"text-h6 font-weight-bold text-indigo-darken-4"},Ee={class:"pa-4"},Ge={class:"d-flex align-center justify-space-between"},Fe={class:"text-h5 font-weight-bold text-indigo-darken-4 mb-0"},Ie={class:"card-header pa-6 pb-4"},Ye={class:"d-flex align-center justify-space-between"},He={class:"text-h6 font-weight-bold text-indigo-darken-4"},Oe={class:"pa-6"},Je={class:"cards-section mb-6"},Ke={class:"text-center py-8"},Le={class:"pa-4"},We={class:"d-flex align-center justify-space-between mb-3"},Xe={class:"text-h6 font-weight-bold text-success"},Ze={class:"d-flex align-center justify-space-between"},$e={class:"text-h5 font-weight-bold text-error"},et={class:"payment-method-section mb-6"},tt={class:"text-subtitle-1 font-weight-bold text-indigo-darken-4 mb-3"},st={class:"d-flex align-center pa-3 w-100"},at={class:"d-flex align-center pa-3 w-100"},lt={key:0,class:"cash-section"},ot={class:"text-subtitle-1 font-weight-bold text-indigo-darken-4 mb-3"},nt={class:"d-flex align-center justify-space-between"},dt={class:"text-h6 font-weight-bold"},it={class:"d-flex align-center justify-space-between"},rt={class:"text-subtitle-2 font-weight-bold"},ut={key:0,class:"gcash-section"},ct={class:"text-subtitle-1 font-weight-bold text-indigo-darken-4 mb-3"},mt={class:"d-flex align-center justify-space-between"},vt={class:"text-h6 font-weight-bold"},pt={class:"d-flex align-center justify-space-between"},ft={class:"text-subtitle-2 font-weight-bold"},_t={class:"text-body-2"},bt={class:"pa-6"},gt={__name:"Payment",props:{ticket:Object,scannedCards:Array,totalCovered:Number,cashNeeded:Number},setup(x){const r=x,V=k(!1),w=k(null),m=k("cash"),u=k(null),v=k(null);k("");const z=k(""),j=b(()=>r.scannedCards||[]),T=b(()=>r.totalCovered||0),c=b(()=>r.cashNeeded||0),U=b(()=>r.ticket.data.hours_parked),H=b(()=>r.ticket.data.park_datetime?B(r.ticket.data.park_datetime).format("hh:mm A"):null),O=b(()=>r.ticket.data.park_out_datetime?B(r.ticket.data.park_out_datetime).format("hh:mm A"):null),C=b(()=>T.value===r.ticket.data.park_fee),J=b(()=>C.value?j.value.length>0:m.value==="cash"?(j.value.length>0||u.value)&&(!u.value||Number(u.value)>=c.value):m.value==="gcash"?(console.log("gcash_amount",v.value),(j.value.length>0||z.value)&&z.value.trim()!==""):!1),K=[{key:"card_number",title:"Card Number"},{key:"price",title:"Price"},{key:"balance",title:"Balance"}],L=b(()=>j.value.map(d=>({card_number:d.card_number,no_of_days:d.no_of_days,price:f(d.price),balance:f(d.balance)}))),E=d=>d?B(d).format("MM/DD/YYYY"):"N/A",W=()=>{ce({ticket_id:r.ticket.data.id,hours_parked:r.ticket.data.hours_parked,days_parked:r.ticket.data.days_parked,payment_method:m.value,cash_amount:m.value==="cash"?u.value:null,gcash_amount:m.value==="gcash"?v.value:null,gcash_reference:m.value==="gcash"?z.value:null,cards:j.value.map(e=>e.id)}).post(Y("store.payment"),{onSuccess:()=>{}})},X=async()=>{V.value=!0,setTimeout(Z,300)},Z=async()=>{if(V.value)try{w.value=new ve("reader"),await w.value.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},async d=>{console.log("QR code detected ✅",d),await M(),me.post(Y("scan.qr.cards"),{qr_code:d,ticket_id:r.ticket.data.id,ticket_uuid:r.ticket.data.uuid})})}catch(d){console.error("Error starting camera:",d.message)}},M=async()=>{if(w.value){try{await w.value.stop(),await w.value.clear()}catch(d){console.error("Error closing scanner:",d)}w.value=null}V.value=!1};return re(()=>{M()}),(d,e)=>{const o=n("v-icon"),$=n("v-card-title"),p=n("v-divider"),ee=n("v-card-text"),te=n("v-spacer"),Q=n("v-btn"),se=n("v-card-actions"),N=n("v-card"),ae=n("v-dialog"),le=n("v-chip"),R=n("v-col"),oe=n("v-data-table-server"),G=n("v-avatar"),F=n("v-radio"),ne=n("v-radio-group"),q=n("v-text-field"),A=n("v-alert"),P=n("v-expand-transition"),I=n("v-row"),de=n("v-container");return g(),S(ue,null,[s(ae,{modelValue:V.value,"onUpdate:modelValue":e[0]||(e[0]=_=>V.value=_),"max-width":"600"},{default:a(()=>[s(N,{rounded:"lg"},{default:a(()=>[s($,{class:"pa-6 pb-4"},{default:a(()=>[t("div",pe,[s(o,{size:"28",color:"indigo-darken-4",class:"mr-3"},{default:a(()=>[...e[5]||(e[5]=[l("mdi-qrcode-scan",-1)])]),_:1}),e[6]||(e[6]=t("span",{class:"text-h6 font-weight-bold"},"Scan Card QR Code",-1))])]),_:1}),s(p),s(ee,{class:"pa-6"},{default:a(()=>[...e[7]||(e[7]=[t("div",{id:"reader",style:{width:"100%",height:"400px","border-radius":"12px",overflow:"hidden"}},null,-1)])]),_:1}),s(p),s(se,{class:"pa-4"},{default:a(()=>[s(te),s(Q,{color:"error",variant:"outlined",onClick:M},{default:a(()=>[s(o,{start:""},{default:a(()=>[...e[8]||(e[8]=[l("mdi-close",-1)])]),_:1}),e[9]||(e[9]=l(" Close ",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t("div",fe,[s(de,{fluid:"",class:"py-8"},{default:a(()=>[s(I,{justify:"center"},{default:a(()=>[s(R,{cols:"12",md:"10",lg:"8"},{default:a(()=>[t("div",_e,[s(o,{size:"48",color:"white",class:"mb-2"},{default:a(()=>[...e[10]||(e[10]=[l("mdi-cash-register",-1)])]),_:1}),e[11]||(e[11]=t("h1",{class:"text-h4 font-weight-bold text-white mb-2"}," Payment Processing ",-1)),e[12]||(e[12]=t("p",{class:"text-white-70"}," Complete your parking payment ",-1))]),s(I,null,{default:a(()=>[s(R,{cols:"12",md:"5"},{default:a(()=>[s(N,{class:"ticket-card elevation-8",rounded:"sm"},{default:a(()=>[t("div",be,[t("div",ge,[t("h3",ye,[s(o,{class:"mr-2"},{default:a(()=>[...e[13]||(e[13]=[l("mdi-ticket-confirmation",-1)])]),_:1}),e[14]||(e[14]=l(" Ticket Details ",-1))]),s(le,{color:"success",variant:"flat",size:"small"},{default:a(()=>[...e[15]||(e[15]=[l(" Active ",-1)])]),_:1})])]),s(p),t("div",he,[t("div",xe,[t("div",ke,[s(o,{size:"20",color:"indigo-darken-4",class:"mr-2"},{default:a(()=>[...e[16]||(e[16]=[l("mdi-barcode",-1)])]),_:1}),e[17]||(e[17]=t("span",{class:"text-caption text-medium-emphasis"},"Ticket Number",-1))]),t("p",we,i(x.ticket.data.ticket_no),1)]),s(p,{class:"my-4"}),t("div",Ce,[t("div",Ne,[s(o,{size:"20",color:"success",class:"mr-2"},{default:a(()=>[...e[18]||(e[18]=[l("mdi-login",-1)])]),_:1}),e[19]||(e[19]=t("span",{class:"text-caption text-medium-emphasis"},"Park In",-1))]),t("p",Pe,i(E(x.ticket.data.park_datetime)),1),t("p",Ve,i(H.value),1)]),t("div",ze,[t("div",je,[s(o,{size:"20",color:"error",class:"mr-2"},{default:a(()=>[...e[20]||(e[20]=[l("mdi-logout",-1)])]),_:1}),e[21]||(e[21]=t("span",{class:"text-caption text-medium-emphasis"},"Park Out",-1))]),t("p",Ae,i(E(x.ticket.data.park_out_datetime)),1),t("p",Se,i(O.value),1)]),s(p,{class:"my-4"}),x.ticket.data.days_parked!==0?(g(),S("div",De,[t("div",Me,[t("div",Qe,[s(o,{size:"20",color:"indigo-darken-4",class:"mr-2"},{default:a(()=>[...e[22]||(e[22]=[l("mdi-calendar-range",-1)])]),_:1}),e[23]||(e[23]=t("span",{class:"text-body-2"},"Number of Days",-1))]),t("span",Re,i(x.ticket.data.days_parked),1)])])):y("",!0),U.value!==0?(g(),S("div",qe,[t("div",Be,[t("div",Te,[s(o,{size:"20",color:"indigo-darken-4",class:"mr-2"},{default:a(()=>[...e[24]||(e[24]=[l("mdi-clock-outline",-1)])]),_:1}),e[25]||(e[25]=t("span",{class:"text-body-2"},"Number of Hours",-1))]),t("span",Ue,i(U.value),1)])])):y("",!0),s(p,{class:"my-4"}),s(N,{class:"total-card elevation-0",color:"indigo-lighten-5",rounded:"lg"},{default:a(()=>[t("div",Ee,[t("div",Ge,[t("div",null,[e[26]||(e[26]=t("p",{class:"text-caption text-medium-emphasis mb-1"},"Total Parking Fee",-1)),t("p",Fe,i(h(f)(x.ticket.data.park_fee)),1)])])])]),_:1})])]),_:1})]),_:1}),s(R,{cols:"12",md:"7"},{default:a(()=>[s(N,{class:"payment-card elevation-8",rounded:"sm"},{default:a(()=>[t("div",Ie,[t("div",Ye,[t("h3",He,[s(o,{class:"mr-2"},{default:a(()=>[...e[27]||(e[27]=[l("mdi-credit-card",-1)])]),_:1}),e[28]||(e[28]=l(" Payment Method ",-1))])])]),s(p),t("div",Oe,[s(Q,{color:"indigo-darken-4",size:"large",block:"",onClick:X,class:"mb-6 scan-card-btn"},{default:a(()=>[s(o,{start:"",size:"24"},{default:a(()=>[...e[29]||(e[29]=[l("mdi-qrcode-scan",-1)])]),_:1}),e[30]||(e[30]=l(" Scan Card QR Code ",-1))]),_:1}),t("div",Je,[e[33]||(e[33]=t("h4",{class:"text-subtitle-1 font-weight-bold text-indigo-darken-4 mb-3"}," Scanned Cards ",-1)),s(oe,{headers:K,items:L.value,"items-per-page":5,density:"comfortable",class:"cards-table elevation-2","disable-sort":"","hide-default-footer":""},{"no-data":a(()=>[t("div",Ke,[s(o,{size:"48",color:"grey-lighten-1",class:"mb-3"},{default:a(()=>[...e[31]||(e[31]=[l(" mdi-credit-card-off-outline ",-1)])]),_:1}),e[32]||(e[32]=t("p",{class:"text-body-2 text-medium-emphasis"}," No cards scanned yet ",-1))])]),_:1},8,["items"])]),s(N,{class:"summary-card elevation-0 mb-6",color:"grey-lighten-4",rounded:"lg"},{default:a(()=>[t("div",Le,[t("div",We,[e[34]||(e[34]=t("span",{class:"text-body-1 font-weight-medium"},"Covered by Cards:",-1)),t("span",Xe,i(h(f)(T.value)),1)]),s(p,{class:"my-3"}),t("div",Ze,[e[35]||(e[35]=t("span",{class:"text-h6 font-weight-bold text-indigo-darken-4"}," Amount Due: ",-1)),t("span",$e,i(h(f)(c.value)),1)])])]),_:1}),t("div",et,[t("h4",tt,[s(o,{class:"mr-2"},{default:a(()=>[...e[36]||(e[36]=[l("mdi-wallet",-1)])]),_:1}),e[37]||(e[37]=l(" Select Payment Method ",-1))]),s(N,{class:"payment-options elevation-0",rounded:"lg",variant:"outlined"},{default:a(()=>[s(ne,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=_=>m.value=_),disabled:C.value,"hide-details":""},{default:a(()=>[s(F,{value:"cash",class:"payment-option-radio"},{label:a(()=>[t("div",st,[s(G,{color:"green-lighten-4",size:"48",class:"mr-4"},{default:a(()=>[s(o,{color:"green-darken-2",size:"28"},{default:a(()=>[...e[38]||(e[38]=[l("mdi-cash",-1)])]),_:1})]),_:1}),e[39]||(e[39]=t("div",null,[t("p",{class:"text-subtitle-1 font-weight-bold mb-0"},"Cash Payment"),t("p",{class:"text-caption text-medium-emphasis mb-0"},"Pay with physical cash")],-1))])]),_:1}),s(p),s(F,{value:"gcash",class:"payment-option-radio"},{label:a(()=>[t("div",at,[s(G,{color:"blue-lighten-4",size:"48",class:"mr-4"},{default:a(()=>[s(o,{color:"blue-darken-2",size:"28"},{default:a(()=>[...e[40]||(e[40]=[l("mdi-cellphone",-1)])]),_:1})]),_:1}),e[41]||(e[41]=t("div",null,[t("p",{class:"text-subtitle-1 font-weight-bold mb-0"},"GCash"),t("p",{class:"text-caption text-medium-emphasis mb-0"},"Pay via GCash mobile wallet")],-1))])]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1})]),s(P,null,{default:a(()=>[m.value==="cash"?(g(),S("div",lt,[t("h4",ot,[s(o,{class:"mr-2"},{default:a(()=>[...e[42]||(e[42]=[l("mdi-cash",-1)])]),_:1}),e[43]||(e[43]=l(" Cash Amount ",-1))]),s(q,{modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=_=>u.value=_),label:"Enter Cash Amount",variant:"outlined",type:"number",disabled:C.value,prefix:"₱",density:"comfortable","hide-details":"auto",hint:C.value?"Payment fully covered by cards":"","persistent-hint":""},{"prepend-inner":a(()=>[s(o,{color:"green-darken-2"},{default:a(()=>[...e[44]||(e[44]=[l("mdi-cash",-1)])]),_:1})]),_:1},8,["modelValue","disabled","hint"]),s(P,null,{default:a(()=>[u.value&&u.value>=c.value?(g(),D(A,{key:0,type:"success",variant:"tonal",class:"mt-4",density:"compact"},{default:a(()=>[t("div",nt,[e[45]||(e[45]=t("span",{class:"font-weight-medium"},"Change:",-1)),t("span",dt,i(h(f)(Number(u.value)-c.value)),1)])]),_:1})):y("",!0)]),_:1}),s(P,null,{default:a(()=>[u.value&&u.value<c.value?(g(),D(A,{key:0,type:"warning",variant:"tonal",class:"mt-4",density:"compact"},{default:a(()=>[t("div",it,[e[46]||(e[46]=t("span",{class:"font-weight-medium"},"Insufficient Amount:",-1)),t("span",rt," Need "+i(h(f)(c.value-Number(u.value)))+" more ",1)])]),_:1})):y("",!0)]),_:1})])):y("",!0)]),_:1}),s(P,null,{default:a(()=>[m.value==="gcash"?(g(),S("div",ut,[t("h4",ct,[s(o,{class:"mr-2"},{default:a(()=>[...e[47]||(e[47]=[l("mdi-cellphone",-1)])]),_:1}),e[48]||(e[48]=l(" GCash Details ",-1))]),s(q,{modelValue:v.value,"onUpdate:modelValue":e[3]||(e[3]=_=>v.value=_),label:"GCash Amount Paid",variant:"outlined",type:"number",disabled:C.value,prefix:"₱",density:"comfortable","hide-details":"auto",placeholder:"0.00"},{"prepend-inner":a(()=>[s(o,{color:"blue-darken-2"},{default:a(()=>[...e[49]||(e[49]=[l("mdi-cash",-1)])]),_:1})]),_:1},8,["modelValue","disabled"]),s(q,{modelValue:z.value,"onUpdate:modelValue":e[4]||(e[4]=_=>z.value=_),label:"Reference Number",variant:"outlined",type:"text",disabled:C.value,density:"comfortable","hide-details":"auto",class:"mt-4",placeholder:"Enter GCash reference number"},{"prepend-inner":a(()=>[s(o,{color:"blue-darken-2"},{default:a(()=>[...e[50]||(e[50]=[l("mdi-pound",-1)])]),_:1})]),_:1},8,["modelValue","disabled"]),s(P,null,{default:a(()=>[v.value&&v.value>=c.value?(g(),D(A,{key:0,type:"success",variant:"tonal",class:"mt-4",density:"compact"},{default:a(()=>[t("div",mt,[e[51]||(e[51]=t("span",{class:"font-weight-medium"},"Change:",-1)),t("span",vt,i(h(f)(Number(v.value)-c.value)),1)])]),_:1})):y("",!0)]),_:1}),s(P,null,{default:a(()=>[v.value&&v.value<c.value?(g(),D(A,{key:0,type:"warning",variant:"tonal",class:"mt-4",density:"compact"},{default:a(()=>[t("div",pt,[e[52]||(e[52]=t("span",{class:"font-weight-medium"},"Insufficient Amount:",-1)),t("span",ft," Need "+i(h(f)(c.value-Number(v.value)))+" more ",1)])]),_:1})):y("",!0)]),_:1}),s(A,{type:"info",variant:"tonal",class:"mt-4",density:"compact"},{default:a(()=>[t("div",_t,[e[53]||(e[53]=t("strong",null,"Amount to pay:",-1)),l(" "+i(h(f)(c.value)),1)])]),_:1})])):y("",!0)]),_:1})]),s(p),t("div",bt,[s(Q,{disabled:!J.value,block:"",size:"x-large",onClick:W,color:"indigo-darken-4",class:"pay-button"},{default:a(()=>[s(o,{start:"",size:"28"},{default:a(()=>[...e[54]||(e[54]=[l("mdi-check-circle",-1)])]),_:1}),e[55]||(e[55]=t("span",{class:"text-h6 font-weight-bold"},"Complete Payment",-1))]),_:1},8,["disabled"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])],64)}}},wt=ie(gt,[["__scopeId","data-v-bfc40023"]]);export{wt as default};
